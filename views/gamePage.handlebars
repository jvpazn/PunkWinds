<html lang="en">
  <head>
    <link
      href="https://fonts.googleapis.com/css2?family=Sedgwick+Ave+Display&display=swap"
      rel="stylesheet"
    />
    <title>{{gameName}}</title>
    <link rel="icon" href="/img/favicon.png" />
    <link rel="Stylesheet" href="/css/gamePage.css" />
  </head>
  <body>
    <main id="Content">
      <img src="/img/{{gameImg}}.png" class="game-image" />
      <p class="game-name">{{gameName}}</p>

      {{#unless gamePrice}}
      <p class="game-price free">Grátis</p>
      {{else}}
      <p class="game-price paid">R$ {{gamePrice}}</p>
      {{/unless}}

      <div class="review-summary-container">
        <a href="/game/reviews?idgames={{idgames}}&id={{id}}" class="review-button">
           Avaliação: {{mediaReviews}}
        </a>
      </div>

      <form action="/game/comprar" method="POST" class="buy-form">
        <input type="hidden" name="idgames" value="{{idgames}}" />
        <input type="hidden" name="id" value="{{id}}" />

        {{#unless gamePrice}}
        <button type="submit" id="buyButton">Adquirir Jogo</button>
        {{else}}
        <p class="payment-required">Este item requer pagamento.</p>

        <button
          type="button"
          id="buyButton"
          onclick="window.location.href='/comprar?idgames={{idgames}}&id={{id}}'"
        >
          Ir para Pagamento
        </button>
        {{/unless}}
      </form>

      <button id="botao" class="back-button">
        <a href="/?id={{id}}">Voltar</a>
      </button>

      <hr class="content-separator" />

      <div id="commentSection">
        <h2>Comentários</h2>

        {{#if nome}}
        <form action="/game/comentar" method="POST" class="comment-form">
          <input type="hidden" name="id" value="{{id}}" />
          <input type="hidden" name="idgames" value="{{idgames}}" />
          <div class="comment-input-group">
            <input
              type="text"
              name="texto"
              placeholder="Escreva seu comentário..."
              required
              class="comment-input"
            />
            <button type="submit" class="comment-send-button">Enviar</button>
          </div>
        </form>
        {{else}}
        <p>Faça login para comentar!</p>
        {{/if}}

        {{#each comentarios}}
        <div class="comment-card">
          <div class="comment-header">
            <img
              src="/img/{{this.pfpAutor}}.png"
              alt="PFP"
              class="comment-pfp"
            />
            <strong>{{this.nomeAutor}}</strong> says:
          </div>

          <p class="comment-text">{{this.texto}}</p>

          {{#if this.eDono}}
          <div class="comment-actions">
            <form action="/game/comentar/deletar" method="POST" class="action-form">
              <input type="hidden" name="id" value="{{../id}}" />
              <input type="hidden" name="idgames" value="{{../idgames}}" />
              <input
                type="hidden"
                name="idComentario"
                value="{{this.idComentario}}"
              />
              <button type="submit" class="delete-button">Deletar</button>
            </form>

            <form action="/game/comentar/editar" method="POST" class="action-form edit-form">
              <input type="hidden" name="id" value="{{../id}}" />
              <input type="hidden" name="idgames" value="{{../idgames}}" />
              <input
                type="hidden"
                name="idComentario"
                value="{{this.idComentario}}"
              />
              <input
                type="text"
                name="novoTexto"
                placeholder="Editar texto..."
                required
                class="edit-input"
              />
              <button type="submit" class="edit-button">Atualizar</button>
            </form>
          </div>
          {{/if}}
        </div>
        {{else}}
        <p>Nenhum comentário ainda. Seja o primeiro!</p>
        {{/each}}
      </div>
      </main>
  </body>
</html>